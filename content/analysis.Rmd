---
title: "Analysis"
description: null
toc: yes
output:
html_document:
df_print: paged
featuredImage: https://upload.wikimedia.org/wikipedia/commons/7/77/Pebbleswithquarzite.jpg
draft: noww
featuredVideo: null
---

This comes from the file `content/analysis.Rmd`.

We describe here our detailed data analysis.


```{r, echo=FALSE}
library(tidyverse)
print(getwd())
load(here::here("dataset-ignore/clean_wage.RData"))
load(here::here("dataset/wage_data_clean2.RData"))
print(ls())
```

As senior students, we often question ourselves about what we are doing right now. What those 22 years of education could bring us in the future? Money? Fame? We want to be rich but we don’t know if all those years of hard-work could lead to a rich life. Therefore, we want to explore the relationship between wage and education.

We also noticed that sexism is a huge issue in society, especially when it comes to wage. So we are also interested in the factors that result in the wage difference in terms of gender.

Along the way of exploration, we discovered some interesting variables that may also influence the wage. So we’re going to build models to predict wages based on those variables.

We are interested in the relationship between wage and variables including education, sex, age, family size, weeks worked last year, English-speaking ability, marital status, ownership of bathtub or shower, and region.

The questions are trying to answer are:
1. What factors are significant to predict one’s wage?
2. How does gender influence the performance of some variables toward wage?

## correlation matrix
We ran a Correlation Matrix to see if there are any highly correlated variables. OWNERSHIP ~ SHOWER caught our eyes so we decided to drop SHOWER because the correlation rate of “shower” and other variables are quite high. 

```{r correlation matrix, echo=false}
install.packages("GGally",repos = "http://cran.us.r-project.org")
library(GGally)
wage_data_clean2 %>%
ggcorr(method = c("everything", "pearson")) 

```

## Full Model
We aim to build a model that can be used to predict wage. The independent variables we are interested in are education, sex, age, family size, weeks worked last year, english-speaking ability, marital status, ownership of bathtub or shower, and region.
    
### Raw Model
We run the model1 with all variables above included.

```{r wage model1, echo=false}
library(tidyverse)
lm_mod1 <-lm(INCWAGE ~ EDUC.f + SEX.f + MARST.f + SPEAKENG.f + STATE.f + FAMSIZE + AGE, data = clean_wage)

broom::tidy(lm_mod1) %>%
  dplyr::select(term, estimate, p.value) %>% 
  mutate(across(where(is.numeric), ~round(., 5))) %>% 
  DT::datatable()
```

By looking at the p-value from model1, we decided to drop ‘state’ and run the regression model again. 

#### BACKWARD STEPWISE REGRESSION
We ran a BACKWARD STEPWISE REGRESSION and figured that all the variables are significant in our model.

```{r backward stepwise regression, echo=false}
library(MASS)
backward <- step(lm_mod1, direction = "backward", scope = formula(lm_mod1), trace = 0)
backward$anova
backward$coefficients
summary(backward)
```


### Final Model

```{r wage model2, echo=false}
suppressPackageStartupMessages(library(tidyverse))
lm_mod2 <-lm(INCWAGE ~ EDUC.f + SEX.f + MARST.f + SPEAKENG.f + FAMSIZE + AGE, data = clean_wage)

broom::tidy(lm_mod2) %>%
   dplyr::select(term, estimate, p.value) %>% 
  mutate(across(where(is.numeric), ~round(., 5))) %>% 
  DT::datatable()
```

Our final model enables us to use variables including years of education, marital status, ability to speak English, family size and age to predict one’s wage. 


### Coefficient Breakdown
#### wage ~ education
```{r variable: EDUC graph model, echo=false}
suppressPackageStartupMessages(library(tidyverse))
lm_mod3 <-lm(INCWAGE ~ EDUC.f, data = clean_wage)

broom::tidy(lm_mod3) %>%
   dplyr::select(term, estimate, p.value) %>% 
  mutate(across(where(is.numeric), ~round(., 5))) %>% 
  DT::datatable()
```

```{r variable: EDUC  graph, echo=false}
#relationship between wage and education
clean_wage %>%
ggplot(aes(x = as.factor(EDUC), y = INCWAGE)) + geom_boxplot()+labs(title="Education vs. Wage", x="Education", y="Wage")
```
We noticed that at first, as the year of education increase, the wage is lower comparing with no schooling. However, since level 6, which is grade 12, one's wage increases as education level increase.
    
##### wage ~ education (by sex)


```{r variable: EDUC + gender, echo=false}
#relationship between wage and education colored by gender

library(ggplot2)
library(tidyr)
clean_wage %>% 
  ggplot(aes(x = as.factor(EDUC), y = INCWAGE, color=as.factor(SEX))) + geom_boxplot(outlier.shape = NA)+labs(title="Education vs. Wage by gender", x="Education", y="Wage")
```
From the graph and interaction analysis, we can find gender does play a role in influence education's effect on wage: no matter how much education one have received, male's average wage is always higher than female. 

```{r variable: EDUC + gender + EDUC*gender, echo=false}
edu_gd <- lm(INCWAGE ~ EDUC.f + SEX.f + EDUC.f*SEX.f, data = clean_wage)

broom::tidy(edu_gd) %>%
   dplyr::select(term, estimate, p.value) %>% 
  mutate(across(where(is.numeric), ~round(., 5))) %>% 
  DT::datatable()

```


```{r QQ, echo=false}
par(mfrow = c(2, 2))
plot(lm_mod3)
```


```{r female/male, echo=false}
male_data <- clean_wage %>%
  filter(SEX==1)

female_data <- clean_wage %>%
  filter(SEX==2)
```

```{r EDUC_male, echo=false}
suppressPackageStartupMessages(library(tidyverse))
lm_educ_male <-lm(INCWAGE ~ as.factor(EDUC), data = male_data)

broom::tidy(lm_educ_male) %>%
  dplyr::select(term, estimate, p.value) %>% 
  mutate(across(where(is.numeric), ~round(.,))) %>% 
  DT::datatable()
```

```{r EDUC_female, echo=false}
suppressPackageStartupMessages(library(tidyverse))
lm_educ_female <-lm(INCWAGE ~ as.factor(EDUC), data = female_data)

broom::tidy(lm_educ_female) %>%
   dplyr::select(term, estimate, p.value) %>% 
  mutate(across(where(is.numeric), ~round(.,))) %>% 
  DT::datatable()
```

From the graph and interaction analysis, we can find gender does play a role in influence education's effect on wage: no matter how much education one have received, male's average wage is always higher than female. 

#### wage ~ age (by sex)

```{r q1.2.2, echo=false }
#relationship between wage and education colored by gender
clean_wage %>%
ggplot(aes(x = AGE, y = INCWAGE, color=as.factor(SEX))) + geom_smooth() + labs(title="Age vs. Wage", x="Age", y="Wage")
```
Wage increases as age increase from 14 to 30, and then decreases. 

#### wage ~ marital status  (by sex)
```{r MARST graphT, echo=false}
clean_wage %>%
ggplot(aes(x = as.factor(MARST), y = INCWAGE, color=as.factor(SEX))) + geom_boxplot() + labs(title="Marital Status vs. Wage", x="Marital Status", y="Wage")
```
Generally speaking, married people are more likely to have higher wages. However, we can clearly find the gender differences in terms of marriage. The wage gap between male and female is much larger for those who are married compared to not married. Therefore, it’s reasonable to assume that being married is associated with higher earnings, but its effect on male is much more significant than on female. 

## Conclusion 
We provides a model that can help us to use years of education, marital status, ability to speak English, family size and age to predict one’s wage to predict one's wage. 

-------

## Note on Attribution

If you are directly quoting from a source, please make that clear. You can show quotes using `>` like this

```
> To be or not to be.
```

> To be or not to be.

Also, make sure to provide a link or citation to where you are quoting from.

-------


## Rubric: On this page

you will


* Introduce what motivates your Data Analysis (DA)
  * Which variables and relationships are you most interested in?
```{r q1.1}
#the relationship between wage and education.
#what factors can influence one's wage and salary
```
  
  * What questions are you interested in answering?
```{r q1.2.1 variable: EDUC}
#relationship between wage and education

```
  
* Breadth of the DA
  * Make sure that you ask enough initial questions to explore the different variables in your data.
  * i.e. Do you explore more than just one or two variables? Do you explore a few different relationships or many?
```{r q2}
#relationship between wage and education colored by gender


```
  
* Depth of the DA
  * When you answer one question, usually more questions arise as well. 
  * The depth of the DA is about coming up with and exploring the answers to these questions, often iterating the process a few times.
* Modeling and Inference 

  * You should also include some kind of formal statistical model and/or inference. This could be a linear regression, logistic regression, hypothesis testing etc.
  
  * Explain the techniques you used for validating your results.
  * Describe the results of your modelling and make sure to give a sense of the uncertainty in your estimates and conclusions.
* Explain the flaws and limitations of your analysis
  * Are there some assumptions that you needed to make that might not hold? Is there other data that would help to answer your questions? ...
* Clarity Figures
  * Are your figures/tables/results easy to read, informative, without problems like overplotting, hard-to-read labels, etc?
  * Each figure should provide a key insight. Too many figures or other data summaries can detract from this.
* Clarity of Explanations
  * Do you introduce why you are doing each analysis?
  * How well do you explain each figure/result?
  * Do you provide interpretations that suggest further analysis or explanations for observed phenomenon?
* Organization and cleanliness.
  * Make sure to remove excessive warnings, use clean easy-to-read code, organize with sections or multiple pages, use bullets, etc.
  
  
**NOTE**: Your Data Analysis can be broken up into multiple pages if that helps with your organization.